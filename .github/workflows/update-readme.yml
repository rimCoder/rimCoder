name: Update GitHub Stats Inline SVG

on:
  schedule:
    - cron: '0 0 * * *' 
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Fetch GitHub Stats SVG
        run: |
          # fetch the SVG using your token
          curl -s \
            -H "Authorization: token ${{ secrets.GH_STATS_TOKEN }}" \
            "https://github-readme-stats.vercel.app/api?username=rimCoder&show_icons=true&theme=radical&rank_icon=github&count_private=true&hide_title=true&hide_border=true" \
            -o stats.svg

      - name: Embed SVG into README
        run: |
          # Remove old stats block and insert new SVG
          awk '/<!-- START GITHUB STATS -->/{print;system("cat stats.svg");next} /<!-- END GITHUB STATS -->/{next}1' README.md > README.tmp
          mv README.tmp README.md

      - name: Commit changes before pulling remote
        run: |
          git config --local user.name "github-actions[bot]"
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "Update inline GitHub Stats" || echo "No changes to commit"

      - name: Pull latest changes from remote
        run: |
          git pull origin main --rebase

      - name: Push changes
        run: |
          git push origin main